# Used for extension builds
import os
import sys

env = SConscript("godot-cpp/SConstruct")
env_lua = env.Clone()

if env_lua["platform"] == 'linux':
    env_lua.Append(CPPDEFINES='LUA_USE_POSIX')

libraries 		= []
library_paths 	= 'MAKE_LIB'
cppDefines 		= {}
cppFlags 		= ['-Wall']#, '-Werror']
cxxFlags 		= ['-std=c++17']


env_lua.Append(LIBS 			= libraries)
env_lua.Append(LIBPATH 		= library_paths)
env_lua.Append(CPPDEFINES 	= cppDefines)
env_lua.Append(CPPFLAGS 		= cppFlags)
env_lua.Append(CXXFLAGS 		= cxxFlags)
env.Append(CPPPATH=[Dir('lua').abspath])

sources = ['lua/onelua.c']
library_name = "liblua{}{}".format(env['suffix'], env["LIBSUFFIX"])
library = env_lua.StaticLibrary("../bin/external/{}".format(library_name), source=sources)
Default(library)

env.Append(LIBPATH=[env.Dir("../bin/external")])
env.Append(LIBS=[library_name])


Return('env')